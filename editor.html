<html>
<script src="/socket.io/socket.io.js"></script>
<script src="http://localhost:8080/lib/user.js"></script>
<script src="http://localhost:8080/lib/tinymce/js/tinymce/tinymce.min.js"></script>
<script src="http://localhost:8080/lib/html.js"></script>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="home.css">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.6" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
</head>
<script>
tinymce.init({
    selector: "textarea",
    plugins: [
        "advlist autolink lists link image charmap print preview anchor",
        "searchreplace visualblocks code fullscreen",
        "insertdatetime media table contextmenu paste"
    ],
    toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"
});

	var socket = io.connect("http://" + window.location.host + "/");
	var gameid = "";
	var buttonid = 0;

	function initiate() {
		var param = window.location.search.replace("?", "");
		param = param.split("=");
		gameid = param[1];
		var mobile_url = "http://" + window.location.host + "/Games/" + gameid
				+ "/index.html";
		var monitor_url = "http://" + window.location.host + "/Games/" + gameid
				+ "/monitor.html";

		if (gameid != null) {
			$('#mobile').attr("src", mobile_url);
			$('#monitor').attr("src", monitor_url);
		}
	}

	function save() {
		var html = $("#mobile").contents().find("html").html();
		var path = './Games/' + gameid + '/index.html';
		socket.emit("save", path, html);
	}

	function add(element) {
		var html = new Html();
		var name = "button" + buttonid;
		var button = html.addButton(name, 'youtube',
				'https://www.youtube.com/watch?v=f_SnZubaArM');
		$('#mobile').contents().find('body').append(button);
		alert($("#mobile").contents().find("html").html());
		save();
		buttonid++; //slordig
	}

	function edit() {
		
		var id = $("#id").val();
		var title = $("#name").val();
		var content = $("#content").val();

		$('#mobile').contents().find("#" + id).attr("onclick",
				"emitter('youtube','" + content + "')");
		$('#mobile').contents().find("#" + id).html(title);
		save();
	}
	
	$(document).ready(function() {
		$("#mobile").load(function() {
			buttonid = $("#mobile").contents().find("button").size()+1;
		 $("#mobile").contents().find("button").bind("contextmenu",function(e){
	        e.preventDefault();
	        var name = $(this.id).html();
	        $("#id").attr("value",this.id);
	        $("#name").attr("value",name);
	        $("#edit" ).dialog();
	      });
		});
	});
	
	function shows(){
		alert(tinyMCE.activeEditor.getContent());
	}
</script>
<body onload="initiate()">
	<div id="wrap">
		<div id="add">
			<img onclick="add('button')"
				src="http://localhost:8080/img/button.png" /> <img
				onclick="edit('Test','Hallo','#')"
				src="http://localhost:8080/img/image.png" /> <img
				src="http://localhost:8080/img/text.png" /> <img
				src="http://localhost:8080/img/vimeo.png" /> <img
				src="http://localhost:8080/img/youtube.png" />
		</div>
		<iframe id="mobile" src=""></iframe>
		<iframe id="monitor" src=""></iframe>
	</div>
	<div id="edit" style="display:none" title="properties">
		<p style = "display:none"><input type="text" id="id" name="id"><br></p>
	 	Name: <input type="text" id="name" name="name"><br>
  		Type: <input type="text" id="type" name="type"><br>
    	Content: <input type="text" id="content" name="content"><br>
  	    <button onclick="edit()">Opslaan</button>
	</div>
	<form method="post" action="somepage">
    <textarea name="content" style="width:100%"></textarea>
</form>
<button onclick="shows()">Show</button>
</body>
</html>