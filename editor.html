<html>
<!-- -------Yahoo! CSS Javascript--------------------------------------------------- -->

<!-- Combo-handled YUI CSS files: -->
<link rel="stylesheet" type="text/css"
	href="http://yui.yahooapis.com/combo?2.9.0/build/assets/skins/sam/skin.css">
<!-- Combo-handled YUI JS files: -->
<script type="text/javascript"
	src="http://yui.yahooapis.com/combo?2.9.0/build/yahoo-dom-event/yahoo-dom-event.js&2.9.0/build/element/element-min.js&2.9.0/build/connection/connection-min.js&2.9.0/build/dragdrop/dragdrop-min.js&2.9.0/build/container/container-min.js&2.9.0/build/menu/menu-min.js&2.9.0/build/button/button-min.js&2.9.0/build/editor/editor-min.js"></script>

<!-- -------------------------------------------------------------------------------------------------- -->

<script src="/socket.io/socket.io.js"></script>
<script src="http://localhost:8080/lib/user.js"></script>
<script
	src="http://localhost:8080/lib/tinymce/js/tinymce/tinymce.min.js"></script>
<script src="http://localhost:8080/lib/html.js"></script>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="home.css">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.6" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
</head>
<script>
	YAHOO.namespace("example.container");

	$(document).ready(function() {

		var myEditor = new YAHOO.widget.Editor('msgpost', {
			width : "30em",
			dompath : true, //Turns on the bar at the bottom
			animate : true
		//Animates the opening, closing and moving of Editor windows
		});
		myEditor.render();

		// Define various event handlers for Dialog
		var handleSubmit = function() {
			edit();
		};
		var handleCancel = function() {
			this.cancel();
			
		};

		// Instantiate the Dialog
		YAHOO.example.container.dialog1 = new YAHOO.widget.Dialog("dialog1", {
			width : "70em",
			fixedcenter : true,
			visible : false,
			constraintoviewport : true,
			buttons : [ {
				text : "Save",
				handler : handleSubmit,
				isDefault : true
			}, {
				text : "Cancel",
				handler : handleCancel
			} ]
		});

		// Render the Dialog
		YAHOO.example.container.dialog1.render();
	});

	var myEditor = new YAHOO.widget.Editor('msgbox', {
		//height : '300px',
		width : '522px',
		//dompath : true, //Turns on the bar at the bottom
		animate : true
	//Animates the opening, closing and moving of Editor windows
	});
	myEditor.render();


	var socket = io.connect("http://" + window.location.host + "/");
	var gameid = "";
	var mobile_url = "";
	var monitor_url = "";

	function initiate() {
		var param = window.location.search.replace("?", "");
		param = param.split("=");
		gameid = param[1];
		mobile_url = "http://" + window.location.host + "/Games/" + gameid
				+ "/index.html";
		monitor_url = "http://" + window.location.host + "/Games/" + gameid
				+ "/monitor.html";

		if (gameid != null) {
			$('#mobile').attr("src", mobile_url);
			$('#monitor').attr("src", monitor_url);
		}
	}

	function save() {
		var html_mobile = $("#mobile").contents().find("html").html();
		var html_monitor = $("#monitor").contents().find("html").html();
		var path_mobile = './Games/' + gameid + '/index.html';
		var path_monitor = './Games/' + gameid + '/monitor.html';
		
		socket.emit("save", path_mobile, html_mobile);
		socket.emit("save", path_monitor, html_monitor);
	}

	function add(element) {
		var html = new Html();
		var buttonid = $("#mobile").contents().find(".buttons").size() + 1;
		var name = "button" + buttonid;
		var button = html.addButton(name, 'youtube',
				'https://www.youtube.com/watch?v=f_SnZubaArM');
		$('#mobile').contents().find('body').append(button);
		save();
		setTimeout('reload("mobile")', 100);
	}

	function reload(iframeid) {
		var iframe = document.getElementById(iframeid);
		iframe.src = iframe.src;
	}
	
	function addMonitorText(id,editorContent){
		var html = new Html();
		var content = html.addDiv(id,editorContent);
		$('#monitor').contents().find('body').append(content);
		save();
	}

	function edit() {
		var selected = $("select option:selected").val();
		var id = $("#id").val();
		var title = $("#name").val();
		var editorContent = "";

		if (selected == "youtube") {
			var content = $("#url_value").val();
		} else {
			var content = "#" + id;

			alert(editorContent);
			addMonitorText(id, editorContent);
		}
		$('#mobile').contents().find("#" + id).attr("onclick",
				"emitter('youtube','" + content + "')");
		$('#mobile').contents().find("#" + id).html(title);
		save();
	}

	$(document).ready(
			function() {
				//dialog1.render();
				//content div is an url field by default

				$("#mobile").load(
						function() {
							$("#mobile").contents().find(".buttons").bind(
									"contextmenu", function(e) {
										e.preventDefault();
										var name = $("#mobile").contents().find("#"+this.id).text();
										$("#id").attr("value", this.id);
										$("#name").attr("value", name);
										$("#id").text(this.id);
										$("#name").text(name);
										YAHOO.example.container.dialog1.show();
									});
							$("#mobile").contents().find(".delete").bind(
									"click", function(e) {
										$(this).prev().remove();
										$(this).remove();
										save();
									});
						});
				$("select").change(function() {
					var url_content = $("#url").html();
					var text_content = $("#textarea").html();
					var value = $("select option:selected").val();
					if (value == "youtube") {
						$("#url").attr("style", "display :block");
						$("#text").attr("style", "display :none");
					} else {
						$("#url").attr("style", "display :none");
						$("#text").attr("style", "display :block");

					}
				}).trigger('change');
			});
</script>
<body class="yui-skin-sam" onload="initiate()">
	<div id="wrap">
		<div id="add">
			<img onclick="add('button')"
				src="http://localhost:8080/img/button.png" /> <img
				onclick="edit('Test','Hallo','#')"
				src="http://localhost:8080/img/image.png" /> <img
				src="http://localhost:8080/img/text.png" /> <img
				src="http://localhost:8080/img/vimeo.png" /> <img
				src="http://localhost:8080/img/youtube.png" />
		</div>
		<iframe id="mobile" src=""></iframe>
		<iframe id="monitor" src=""></iframe>
	</div>
	<div id="dialog1" class="yui-pe-content">
			<p style="display: none">
				<input type="text" id="id" name="id" value=""><br>
			</p>
			Name: <input type="text" id="name" name="name" value=""><br> <br>
			Type: <select id="type">
				<option value="youtube">Youtube</option>
				<option value="text">Text</option>
			</select> <br> <br> Content:
			<div id="url" style="display: none">
				<input id="url_value" name="url"><br>
			</div>
			<textarea name="msgpost" id="msgpost" cols="50" rows="10"></textarea>
			<button onclick="edit()">Save</button>
	</div>
</body>
</html>